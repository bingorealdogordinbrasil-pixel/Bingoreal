<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rifa Milhar - R$ 500</title>
    <style>
        :root { --bg: #050505; --card: #121212; --primary: #2ecc71; --gold: #f1c40f; --text: #fff; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-top: 250px; }
        header { position: fixed; top: 0; width: 100%; z-index: 1000; background: #000; border-bottom: 2px solid var(--gold); }
        .navbar { display: flex; justify-content: space-between; padding: 15px; background: #111; }
        #painel-sorteio { padding: 15px; text-align: center; }
        .premio-box { background: linear-gradient(45deg, #d4af37, #f1c40f); color: #000; padding: 10px 25px; border-radius: 50px; font-weight: 900; animation: pulse 2s infinite; display: inline-block; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .grid-tabela { display: grid; grid-template-columns: repeat(auto-fill, minmax(70px, 1fr)); gap: 8px; max-height: 400px; overflow-y: auto; padding: 10px; background: #000; }
        .num-item { padding: 15px 0; text-align: center; background: #181818; border: 1px solid #222; border-radius: 6px; cursor: pointer; }
        .num-item.selecionado { background: var(--primary); color: #000; font-weight: bold; }
        #modal-pix { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:5000; justify-content:center; align-items:center; flex-direction:column; }
        .modal-content { background:#fff; padding:20px; border-radius:15px; color:#000; text-align:center; max-width: 300px; }
    </style>
</head>
<body>

<header>
    <div class="navbar">
        <div onclick="toggleMenu()" style="cursor:pointer;">‚ò∞ <span id="cart-count">0</span></div>
        <div style="color: var(--primary);">R$ 0,50 CADA</div>
        <button onclick="toggleMenu()" style="background:var(--primary); border:none; padding:8px; border-radius:5px;">CARRINHO</button>
    </div>
    <div id="painel-sorteio">
        <div class="premio-box">üéÅ PR√äMIO: R$ 500,00</div>
    </div>
</header>

<div id="modal-pix">
    <div class="modal-content">
        <h3>Pague com PIX</h3>
        <img id="qr-code-img" src="" style="width:200px;">
        <p>Copia e Cola:</p>
        <textarea id="pix-copia-cola" style="width:100%; height:50px;"></textarea>
        <button onclick="document.getElementById('modal-pix').style.display='none'" style="background:red; color:#fff; width:100%; border:none; padding:10px; margin-top:10px;">FECHAR</button>
    </div>
</div>

<div class="card" style="max-width:600px; margin: auto; padding: 15px;">
    <select id="filtro" onchange="renderizarTabela()" style="width:100%; padding:10px; margin-bottom:10px;">
        <option value="0">0000 a 0999</option>
        <option value="1000">1000 a 1999</option>
    </select>
    <div id="tabela" class="grid-tabela"></div>
</div>

<script>
    const selecionados = new Set();
    const PRECO = 0.50;

    function renderizarTabela() {
        const tabela = document.getElementById('tabela');
        const inicio = parseInt(document.getElementById('filtro').value);
        tabela.innerHTML = "";
        for (let i = inicio; i <= inicio + 999; i++) {
            const item = document.createElement('div');
            item.className = 'num-item' + (selecionados.has(i) ? ' selecionado' : '');
            item.innerText = i.toString().padStart(4, '0');
            item.onclick = () => toggleNumero(i);
            tabela.appendChild(item);
        }
    }

    function toggleNumero(n) {
        if (selecionados.has(n)) selecionados.delete(n);
        else selecionados.add(n);
        document.getElementById('cart-count').innerText = selecionados.size;
        renderizarTabela();
    }

    async function gerarPixReal() {
        if (selecionados.size === 0) return alert("Escolha um n√∫mero!");
        const total = (selecionados.size * PRECO).toFixed(2);

        const res = await fetch('/api/gerar-pix', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ valor: total, descricao: "Compra de Rifa" })
        });
        const data = await res.json();
        if (data.point_of_interaction) {
            document.getElementById('qr-code-img').src = `data:image/png;base64,${data.point_of_interaction.transaction_data.qr_code_base64}`;
            document.getElementById('pix-copia-cola').value = data.point_of_interaction.transaction_data.qr_code;
            document.getElementById('modal-pix').style.display = 'flex';
        }
    }

    function toggleMenu() {
        const conf = confirm(`Total: R$ ${(selecionados.size * PRECO).toFixed(2)}\nDeseja pagar agora?`);
        if(conf) gerarPixReal();
    }

    renderizarTabela();
</script>
</body>
</html>

