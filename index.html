<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bingo Real - Oficial</title>
    <style>
        :root { --primary: #facc15; --bg: #020617; --card: #1e293b; --success: #22c55e; }
        
        html, body { 
            overflow: hidden; height: 100%; position: fixed; width: 100%;
            font-family: sans-serif; background: var(--bg); color: white; text-align: center; margin: 0; padding: 0; 
        }
        .hidden { display: none !important; }

        /* NOTIFICAÃ‡ÃƒO (TOAST) */
        #toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(15, 23, 42, 0.95); color: var(--primary);
            padding: 12px 24px; border-radius: 50px; border: 1px solid var(--primary);
            font-size: 13px; font-weight: bold; z-index: 5000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            display: none;
        }

        /* HEADER E STATUS */
        .header { display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: #0f172a; border-bottom: 2px solid var(--primary); height: 50px; }
        .status-bar-topo { display: grid; grid-template-columns: 1fr 1fr 1fr; background: #1e293b; padding: 8px 5px; border-bottom: 1px solid #334155; }
        .status-item { display: flex; flex-direction: column; gap: 2px; border-right: 1px solid #334155; }
        .status-label { font-size: 8px; color: #94a3b8; text-transform: uppercase; }
        .status-val { font-size: 12px; font-weight: bold; }

        /* ANIMAÃ‡ÃƒO DE SALDO */
        .saldo-atualizado { animation: brilho 1.5s; }
        @keyframes brilho {
            0% { color: var(--success); transform: scale(1); }
            50% { color: #fff; transform: scale(1.1); }
            100% { color: var(--success); transform: scale(1); }
        }

        /* JOGO E BOTÃ•ES */
        .container-compra-topo { background: #0f172a; padding: 10px; display: flex; gap: 6px; justify-content: center; }
        .btn-compra { background: #2563eb; color: white; border: none; padding: 10px 20px; border-radius: 6px; font-weight: bold; }
        .card { background: var(--card); padding: 15px; border-radius: 12px; border: 1px solid var(--primary); margin: 10px; }
        
        /* MODAL */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; align-items: center; justify-content: center; z-index: 3000; }
        .modal-content { background: white; padding: 20px; border-radius: 12px; color: black; width: 85%; max-width: 300px; }
    </style>
</head>
<body>

<div id="toast"></div>

<div id="telaJogo">
    <div class="header">
        <div style="font-weight:bold; color:var(--primary);">BINGO REAL</div>
        <button onclick="abrirModalValor()" style="background:var(--success); color:white; border:none; padding:6px 15px; border-radius:4px; font-weight:bold;">DEPOSITAR</button>
    </div>

    <div class="status-bar-topo">
        <div class="status-item"><span class="status-label">Nome</span><span id="perfilNome" class="status-val">...</span></div>
        <div class="status-item"><span class="status-label">Saldo</span><span id="playerSaldoStatus" class="status-val" style="color:var(--success);">R$ 0,00</span></div>
        <div class="status-item"><span class="status-label">Meu ID</span><span id="userIdDisplay" class="status-val">...</span></div>
    </div>

    <div class="container-compra-topo">
        <input type="number" id="qtdCartelas" value="1" style="width:50px; text-align:center;">
        <button onclick="comprarCartelas()" class="btn-compra">COMPRAR CARTELA</button>
    </div>

    <div class="card">
        <div id="bolaGrande" style="font-size:40px; font-weight:bold; color:var(--primary);">--</div>
        <p>Aguardando sorteio...</p>
    </div>
</div>

<div id="modalValor" class="modal hidden">
    <div class="modal-content">
        <h3>Depositar</h3>
        <input type="number" id="valorInputManual" placeholder="MÃ­nimo R$ 10" style="width:100%; padding:10px; margin-bottom:10px;">
        <button onclick="confirmarGerarPix()" style="background:var(--success); color:white; width:100%; padding:12px; border:none; border-radius:6px; font-weight:bold;">GERAR QR CODE</button>
        <button onclick="document.getElementById('modalValor').classList.add('hidden')" style="margin-top:10px; border:none; background:none; color:red;">Cancelar</button>
    </div>
</div>

<div id="modalPix" class="modal hidden">
    <div class="modal-content">
        <h4>Pagamento PIX</h4>
        <img id="qrImagem" style="width:200px; margin:10px 0;">
        <input type="text" id="pixCopiaCola" readonly style="width:100%; font-size:10px;">
        <button onclick="copiarCodigoPix()" style="background:#2563eb; color:white; width:100%; padding:10px; margin-top:10px; border:none;">COPIAR CÃ“DIGO</button>
        <button onclick="document.getElementById('modalPix').classList.add('hidden')" style="margin-top:10px; border:none; color:red;">Fechar</button>
    </div>
</div>

<script>
    const API = "https://bingoreal.onrender.com"; 
    let USER_ID = localStorage.getItem('userId');
    let saldoAtual = 0;

    function showToast(msg) {
        const t = document.getElementById('toast');
        t.innerText = msg; t.style.display = 'block';
        setTimeout(() => t.style.display = 'none', 2500);
    }

    async function verificarAcesso() {
        if (!USER_ID) {
            const nome = prompt("Bem-vindo! Digite seu nome para criar sua conta:");
            if (nome) {
                try {
                    const res = await fetch(`${API}/criar-usuario`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            name: nome, 
                            email: nome.replace(/\s/g, '').toLowerCase() + Date.now() + "@bingo.com" 
                        })
                    });
                    const user = await res.json();
                    if (user._id) {
                        localStorage.setItem('userId', user._id);
                        USER_ID = user._id;
                        location.reload();
                    }
                } catch (e) { alert("Erro ao conectar servidor."); }
            }
        } else {
            atualizarInterface();
            setInterval(atualizarInterface, 4000);
        }
    }

    async function atualizarInterface() {
        if(!USER_ID) return;
        try {
            const resUser = await fetch(`${API}/user-data/${USER_ID}`);
            const user = await resUser.json();
            if (user) {
                const elSaldo = document.getElementById('playerSaldoStatus');
                if (user.saldo > saldoAtual && saldoAtual !== 0) {
                    elSaldo.classList.add('saldo-atualizado');
                    setTimeout(() => elSaldo.classList.remove('saldo-atualizado'), 2000);
                    showToast("ðŸ’° Saldo Atualizado!");
                }
                saldoAtual = user.saldo;
                elSaldo.innerText = `R$ ${user.saldo.toFixed(2)}`;
                document.getElementById('perfilNome').innerText = user.name.toUpperCase();
                document.getElementById('userIdDisplay').innerText = USER_ID.substring(0,8);
            }
        } catch(e) {}
    }

    async function confirmarGerarPix() {
        const val = parseFloat(document.getElementById('valorInputManual').value);
        if (!val || val < 10) return alert("MÃ­nimo R$ 10");

        try {
            document.getElementById('modalValor').classList.add('hidden');
            showToast("Gerando PIX...");
            const res = await fetch(`${API}/gerar-pix`, { 
                method: 'POST', 
                headers: {'Content-Type': 'application/json'}, 
                body: JSON.stringify({ userId: USER_ID, valor: val }) 
            });
            const data = await res.json();
            if (data.qr_code_base64) {
                document.getElementById('qrImagem').src = `data:image/png;base64,${data.qr_code_base64}`;
                document.getElementById('pixCopiaCola').value = data.qr_code;
                document.getElementById('modalPix').classList.remove('hidden');
            }
        } catch (e) { alert("Erro ao gerar PIX."); }
    }

    function copiarCodigoPix() {
        const input = document.getElementById('pixCopiaCola');
        input.select();
        document.execCommand('copy');
        showToast("CÃ³digo Copiado!");
    }

    function abrirModalValor() { document.getElementById('modalValor').classList.remove('hidden'); }

    window.onload = verificarAcesso;
</script>

</body>
</html>
